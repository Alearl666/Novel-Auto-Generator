# 📚 Novel Auto Generator | 小说自动生成器

<div align="center">

[![GitHub tag (latest by date)](https://img.shields.io/github/v/tag/CyrilPeng/Novel-Auto-Generator?sort=semver&label=version&color=blue)](https://github.com/CyrilPeng/Novel-Auto-Generator/tags)
[![SillyTavern](https://img.shields.io/badge/SillyTavern-1.10%2B-green.svg)](https://github.com/SillyTavern/SillyTavern)
[![License](https://img.shields.io/badge/license-MIT-orange.svg)](https://github.com/CyrilPeng/Novel-Auto-Generator/blob/main/LICENSE)

**🚀 一款 SillyTavern 扩展插件，让 AI 自动为你续写小说，解放双手！**

**支持断点续传、智能导出、标签提取、多插件兼容、TXT转世界书等功能**

[功能特性](#-功能特性) •
[快速开始](#-快速开始) •
[使用指南](#-使用指南) •
[TXT转世界书](#-txt转世界书) •
[高级功能](#-高级功能) •
[常见问题](#-常见问题)

</div>

---

## ✨ 功能特性

| 功能 | 描述 |
|:---:|:---|
| ⚡ **自动挂机生成** | 设定章节数，一键开始，自动发送提示词让 AI 持续创作 |
| 💾 **断点续传** | 随时暂停/恢复，进度自动保存，关闭页面也不丢失 |
| 🏷️ **智能标签提取** | 从 AI 回复中精准提取指定 XML 标签内容（如 `<content>`） |
| 📊 **实时统计** | 进度条、已用时间、预计剩余时间、错误统计一目了然 |
| 🔄 **自动重试** | 网络波动？响应过短？自动重试，稳定输出 |
| 📤 **多格式导出** | 支持 TXT / JSON 格式，灵活筛选楼层和消息类型 |
| 💬 **弹窗检测** | 智能检测插件弹窗，完美兼容剧情推进、总结等插件 |
| 📚 **TXT转世界书** | 将TXT小说转换为SillyTavern世界书格式，支持多种AI API |
| 📱 **移动端适配** | 完美支持手机端操作，随时随地挂机生成 |
| ❓ **内置帮助** | 每个设置面板都有详细帮助说明，新手友好 |

---

## 🚀 快速开始

### 安装步骤

1. **安装扩展**
   - 进入 `扩展` → `安装扩展`
   - 输入下面链接并安装：
   ```bash
   https://github.com/CyrilPeng/novel-auto-generator
   ```

   # 📚 TXT转世界书部分 (TxtToWorldbook) v3.0.3

一款强大的 SillyTavern 插件，可将 TXT 小说/文本文件通过 AI 自动分析并转换为可直接使用的世界书(Worldbook)格式，让你快速将任意小说变成可交互的角色扮演世界。

---

## 🚀 快速上手 - 使用步骤

### 第一阶段：导入与转换

1. **启用并行处理** - 在设置中开启并行处理以加快转换速度
2. **配置分块参数** - 输入分块字数和请求延时（建议根据API限制调整）
3. **勾选"强制记忆为章节"** - 确保按章节正确分割内容
4. **配置提示词** - 在提示词配置中勾选需要 AI 输出的分类（角色/地点/组织等）
   > 💡 **进阶技巧**：可自定义提示词让 AI 按你的想法输出特定格式的内容
5. **导入 TXT 文件** - 选择你要转换的小说文件
6. **点击"开始"按钮** - 等待 AI 处理所有章节

### 第二阶段：检查与修复

7. **核对章节完整性**
   - 对比剧情大纲和章节队列中的章节数量是否一致
   - 检查是否有遗漏的章节
   - 若有遗漏，点击进入对应章节查看

8. **检查内容完整性**
   - 查看剧情大纲里各章节的 Token 数
   - 低于 200-300 Token 的章节可能被截断
   - 点击进入查看内容是否完整
   - **不完整时**：点击「Roll历史」→「重新Roll」直到内容完整

9. **清除异常标签**
   - 点击「清除标签」功能
   - 输入预设中可能出现的标签进行检测
   - 有标签则清除
   
   > ⚠️ **OP4.5模型特别注意**：需要点击「替换」功能，检查是否存在 `�` 乱码字符，有则手动替换成正确文字

### 第三阶段：别名合并

10. **执行别名合并**
    - 点击「别名合并」按钮
    - 点击「AI两两判断」让 AI 智能识别同一角色/地点的不同称呼
    
    > 💡 **遇到报错时**：
    > - 取消部分组别，减少Token直到不超过上下文限制
    > - 或启用并发模式，设置阈值为100，通过并发方式合并

11. **人工核验**
    - 检查 AI 判断的名字对应关系是否正确
    - 不正确的去掉该行的勾选
    - 确认后点击「确认合并」

12. **重复合并** - 别名合并通常需要进行 **2-3次**，直到没有可合并的条目为止

### 第四阶段：整理与导出

13. **整理条目**（⚠️ 重要：分步操作）
    
    > ⚠️ **操作前务必先导出任务备份！**
    
    - 每次只整理**一种分类**
    - 例如：先整理「角色」分类 → 导出任务备份
    - 然后整理「地点」分类 → 导出任务备份
    - 以此类推
    
    > ⚠️ **注意**：「剧情大纲」条目和「默认世界书」条目**不要整理**

14. **替换主角名称**（可选）
    - 如需将主角替换为 `{{user}}`
    - 使用「批量替换」功能进行名字替换

15. **导出世界书**
    - 点击「导出 SillyTavern 格式」
    - 在 SillyTavern/酒馆中导入此世界书
    - 将世界书绑定到角色卡即可开始游戏！

---

## ✨ 核心功能介绍

### 📖 智能文本分析

| 功能 | 说明 |
|------|------|
| **自动章节识别** | 支持多种章节格式（第X章/第X回/第X卷等），可自定义正则表达式 |
| **智能分块处理** | 按字数自动分割长文本，确保每块内容在 AI 上下文限制内 |
| **并行处理** | 支持多任务并发，大幅提升转换速度 |

### 🎭 丰富的分类体系

内置7种条目分类，可按需启用：

| 分类 | 启用状态 | 说明 |
|------|----------|------|
| **角色** | ✅ 默认启用 | 角色姓名、性别、MBTI、外貌、性格、背景故事等 |
| **地点** | ✅ 默认启用 | 地点名称、位置、特征、重要事件等 |
| **组织** | ✅ 默认启用 | 组织名称、性质、成员、目标等 |
| **道具** | ⬜ 可选 | 道具名称、类型、功能、来源、持有者等 |
| **玩法** | ⬜ 可选 | 玩法规则、参与条件、奖惩机制等 |
| **章节剧情** | ⬜ 可选 | 章节标题、主要事件、出场角色、关键转折等 |
| **角色内心** | ⬜ 可选 | 内心独白、情感变化、动机分析、心理矛盾等 |

> 💡 支持自定义分类和提示词模板

### 🔄 智能别名合并

- **AI 两两判断**：自动识别同一实体的不同称呼（如"张三"和"小张"是同一人）
- **并发合并模式**：支持设置阈值，通过并发处理大量待合并项
- **人工复核**：AI判断后可人工确认或取消错误的合并

### 🔧 条目管理功能

| 功能 | 说明 |
|------|------|
| **单独重Roll** | 对不满意的条目单独重新生成，不影响其他已整理的条目 |
| **多选并发重Roll** | 批量选择多个条目同时重新生成 |
| **直接编辑** | 关键词和内容支持直接在界面上编辑修改 |
| **Roll历史记录** | 每个条目保存独立的生成历史，可挑选任意版本 |
| **整理分类** | 批量整理某一分类下的所有条目 |

### 🔍 查找与替换

| 功能 | 说明 |
|------|------|
| **查找高亮** | 输入关键词快速定位并高亮显示匹配内容 |
| **批量替换** | 支持全局批量替换文本（如替换主角名为 `{{user}}`） |
| **标签清除** | 检测并清除 AI 输出中的异常标签 |

### 📊 Token 统计与预警

- **实时Token计数**：显示每个条目的 Token 数量
- **阈值高亮**：设置阈值，低于阈值的条目自动高亮提醒（用于发现可能被截断的内容）
- **上下文预估**：帮助控制世界书总大小

### ⚙️ 条目配置

每个条目/分类支持独立配置：

| 配置项 | 说明 |
|--------|------|
| **Position（位置）** | 条目在提示词中的插入位置 |
| **Depth（深度）** | 条目的递归深度 |
| **Order（顺序）** | 同位置条目的排序优先级 |
| **自动递增Order** | 导出时自动为同分类条目递增Order值 |

### 💾 数据管理

| 功能 | 说明 |
|------|------|
| **任务导出/导入** | 保存当前工作进度，支持中断后继续 |
| **设置导出/导入** | 保存自定义的提示词和分类配置 |
| **修改历史** | 记录所有修改操作，支持回退到任意版本 |
| **默认世界书** | 可视化配置默认世界书条目 |

### 📤 导出格式

- **SillyTavern 世界书格式**：可直接导入酒馆使用
- 支持配置分类灯状态（常亮/触发）
- 支持配置条目的Position/Depth/Order

---

## 🎯 最佳实践建议

### 参数推荐

| 参数 | 推荐值 | 说明 |
|------|--------|------|
| 分块字数 | 3000-5000 | 根据小说章节长度调整 |
| 请求延时 | 1000-2000ms | 根据 API 限制调整 |
| 并发数 | 2-3 | 过高可能触发限流 |
| Token阈值 | 200-300 | 低于此值提示可能截断 |

### 注意事项

1. **及时备份**：整理条目前务必导出任务备份
2. **分步整理**：每次只整理一种分类，整理后立即备份
3. **检查乱码**：使用 OP4.5 模型时注意检查 `�` 字符
4. **多次合并**：别名合并通常需要 2-3 轮才能处理完所有别名
5. **人工复核**：AI 判断结果仍需人工确认，避免错误合并

---

## 📋 更新日志

### v3.0.3
- ✨ 单独重Roll支持多选条目 + 并发处理
- ✨ 生成结果的关键词和内容允许直接编辑
- ✨ 单独重Roll条目有独立历史记录，可挑选任意一次Roll结果

### v3.0.2
- ✨ 新增单独重Roll条目功能（支持自定义提示词）

### v3.0.0
- ✨ 查找高亮、批量替换
- ✨ 多选整理分类
- ✨ 条目位置/深度/顺序配置
- ✨ 默认世界书UI化
- ✨ 新增默认勾选2递归选项
- ✨ Token计数与阈值高亮

---

## 📞 问题反馈

如遇到问题或有功能建议，欢迎提交 Issue 或 PR。

---

**Happy Role-Playing! 🎮**
