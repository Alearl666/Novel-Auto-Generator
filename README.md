# 📚 Novel Auto Generator

<div align="center">

![Version](https://img.shields.io/badge/version-1.0.0-blue.svg)
![SillyTavern](https://img.shields.io/badge/SillyTavern-1.10%2B-green.svg)
![License](https://img.shields.io/badge/license-MIT-orange.svg)

**🚀 让 AI 自动为你续写小说，解放双手，尽享创作！**

[功能特性](#-功能特性) •
[快速开始](#-快速开始) •
[使用指南](#-使用指南) •
[高级功能](#-高级功能) •
[常见问题](#-常见问题)

</div>

---

## ✨ 功能特性

<table>
<tr>
<td width="50%">

### 🤖 自动生成
- 一键启动，自动续写小说
- 支持设置目标章节数（最高支持 99999 章）
- 实时显示生成进度和预计剩余时间
- 支持暂停、恢复、停止操作
- 智能错误重试机制

</td>
<td width="50%">

### 📤 灵活导出
- 自由选择导出楼层范围
- 可选择包含用户消息或 AI 回复
- 支持 TXT 和 JSON 两种格式
- 自动统计总字数

</td>
</tr>
<tr>
<td>

### 🏷️ 标签提取
- 从原始消息中精确提取指定标签内容
- 支持同时提取多个标签
- 完美配合正则美化使用
- 过滤思考过程，只保留正文

</td>
<td>

### ⚙️ 高度可配置
- 所有面板可折叠，界面整洁
- 详细的帮助文档
- 设置自动保存
- 丰富的时间参数调整

</td>
</tr>
</table>

---

## 🚀 快速开始

### 安装步骤

1. **安装扩展**
   - 进入 `扩展` → `安装扩展`
   - 输入下面链接并安装。
   ```bash
   https://github.com/CyrilPeng/novel-auto-generator
   ```
2. **开始使用**
   - 启用扩展后，找到 📚 **小说自动生成器**
   - 设置目标章节数和提示词
   - 点击 ▶️ **开始**

---

## 📖 使用指南

### 基础使用流程

```
1️⃣ 打开一个聊天会话
        ↓
2️⃣ 设置目标章节数（如：100）
        ↓
3️⃣ 编写生成提示词（如："继续"）
        ↓
4️⃣ 点击「开始」按钮
        ↓
5️⃣ 等待生成完成，自动导出
```

### 界面说明

```
┌─────────────────────────────────────────┐
│  📚 小说自动生成器                        │
├─────────────────────────────────────────┤
│  ⏹️ 已停止                    ← 当前状态  │
│  ████████░░░░░░ 45%          ← 进度条    │
│  45 / 100 (45%)                         │
│  ⏱️ 01:23:45  ⏳ 01:40:00  ❌ 0         │
├─────────────────────────────────────────┤
│  [▶️ 开始] [⏸️ 暂停] [⏯️ 恢复] [⏹️ 停止]  │
│  [🔄 重置]                              │
├─────────────────────────────────────────┤
│  📝 生成设置  ❓ ▼            ← 可折叠   │
│  ├─ 目标章节: [1000]                     │
│  └─ 提示词: [继续推进剧情...]             │
├─────────────────────────────────────────┤
│  📤 导出设置  ❓ ▼                       │
│  ├─ [✓] 导出全部                         │
│  ├─ [ ] 👤 用户消息                      │
│  ├─ [✓] 🤖 AI 回复                       │
│  └─ [✓] 📄 原始 (chat.mes)               │
├─────────────────────────────────────────┤
│  🏷️ 标签提取  ❓ ▼                       │
│  ├─ 模式: [只提取指定标签]                │
│  └─ 标签: [content detail]                  │
└─────────────────────────────────────────┘
```

---

## 🎯 高级功能

### 标签提取

当你使用正则表达式美化 AI 输出时，原始回复可能包含多种标签：

```xml
<思考>这是 AI 的思考过程...</思考>

<content>
这里是小说正文内容，包含角色对话和情节描写...
</content>

<旁白>环境氛围描写...</旁白>
```

使用**标签提取**功能，可以只导出 `<content>` 标签内的正文：

| 设置项 | 操作 |
|--------|------|
| 原始 (chat.mes) | ✅ 勾选 |
| 提取模式 | 选择「只提取指定标签」|
| 标签名称 | 输入 `content` |

#### 多标签提取

支持同时提取多个标签，用空格或逗号分隔：

```
content detail 正文
```

或

```
content, detail, 正文
```

提取结果会按照原文中出现的顺序依次连接。

---

### 楼层范围导出

默认导出所有楼层，也可以指定范围：

| 场景 | 设置 |
|------|------|
| 导出全部 | ✅ 勾选「导出全部」|
| 只导出 10-50 楼 | 取消勾选，设置起始=10，结束=50 |
| 只导出最后 100 楼 | 计算楼层号后设置 |

> 💡 楼层从 **0** 开始计数，与 SillyTavern 一致

---

### 时间参数调整

在「高级设置」面板中可以调整各项时间参数：

| 参数 | 默认值 | 说明 |
|------|--------|------|
| 初始等待 | 2000ms | 发送消息后等待 AI 开始响应 |
| 完成等待 | 3000ms | AI 响应完成后的额外等待时间 |
| 稳定间隔 | 1000ms | 检查内容是否稳定的间隔 |
| 稳定次数 | 5 | 需要连续多少次检查内容不变 |
| 自动保存 | 50 | 每生成多少章自动保存一次 |
| 最大重试 | 3 | 单章失败后的最大重试次数 |
| 最小长度 | 100 | 低于此字数视为生成失败 |

---

## 🔧 调试

在浏览器控制台 (F12) 中可以使用调试命令：

```javascript
// 查看最后一条 AI 消息的原始内容
nagDebug()

// 查看指定楼层的原始内容（如第 5 楼）
nagDebug(5)
```

输出示例：
```
===== NovelGen Debug =====
✅ chat 获取成功，共 50 条

----- 楼层 49 -----
mes: <content>这里是原始内容...</content>

----- 标签测试 [content] -----
结果: 这里是原始内容...
```

---

## ❓ 常见问题

<details>
<summary><b>Q: 标签提取不生效？</b></summary>

请检查：
1. ✅ 是否勾选了「原始 (chat.mes)」
2. 标签名是否正确（区分大小写）
3. 使用 `nagDebug()` 查看原始内容中是否包含该标签

</details>

<details>
<summary><b>Q: 生成过程中报错重试？</b></summary>

可能原因：
- 响应时间过长，超过默认超时
- AI 回复过短，未达到最小长度
- 网络波动

解决方案：
- 在「高级设置」中增加等待时间
- 降低最小章节长度要求
- 检查网络连接

</details>

<details>
<summary><b>Q: 导出的内容是空的？</b></summary>

请检查：
1. 是否勾选了「🤖 AI 回复」
2. 楼层范围是否正确
3. 如果使用标签提取，确认标签名是否匹配

</details>

<details>
<summary><b>Q: 插件不显示？</b></summary>

1. 刷新页面
2. 检查浏览器控制台是否有错误
3. 确认扩展已启用
4. 尝试重新安装

</details>

---

## 📁 文件结构

```
novel-auto-generator/
├── manifest.json    # 扩展配置
├── index.js         # 主程序
├── style.css        # 样式表
└── README.md        # 说明文档
```

---

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

---

## 📜 许可证

MIT License © 2024

---

<div align="center">

**如果这个扩展对你有帮助，请给个 ⭐ Star！**

Made with ❤️ for SillyTavern

</div>

---

## manifest.json 示例

```json
{
    "display_name": "小说自动生成器",
    "loading_order": 100,
    "requires": [],
    "optional": [],
    "js": "index.js",
    "css": "style.css",
    "author": "Your Name",
    "version": "1.0.0",
    "homePage": "https://github.com/your-repo/novel-auto-generator",
    "auto_update": true
}
```